<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMIDI Switcher</title>
    <script type="importmap">
    {
        "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
            "vue-i18n": "https://unpkg.com/vue-i18n@11/dist/vue-i18n.esm-browser.js"
        }
    }
    </script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        @media (max-width: 600px) {
            .container {
                max-width: 100%;
                padding: 0 10px;
            }
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
        .connected { background: #2d5016; }
        .disconnected { background: #5d1e1e; }
        .tap-area {
            width: 100%;
            height: 200px;
            background: #333;
            border: 2px solid #666;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            margin: 20px 0;
            user-select: none;
            color: white;
            font-family: inherit;
            outline: none;
        }
        .tap-area:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3);
        }
        .tap-area.active {
            background: #4a5c2a;
            border-color: #8bc34a;
        }
        
        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .log-timestamp { 
            color: #888; 
            margin-right: 8px;
        }
        .log-source { 
            color: #4CAF50; 
            font-weight: bold; 
            margin-left: 8px;
            margin-right: 4px;
        }
        .log-arrow { 
            color: #FFF; 
            margin: 0 4px;
        }
        .log-destinations { 
            color: #2196F3; 
            margin-left: 4px;
        }
        .log-message { 
            color: #FF9800; 
            margin-right: 8px;
        }
        
        .notification {
            position: fixed;
            right: 20px;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            margin-bottom: 10px;
        }
        
        .notification.success {
            background: #4CAF50;
            top: 20px;
        }
        
        .notification.error {
            background: #f44336;
            top: 80px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        h3 {
            margin: 10px 0 5px 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 通知システム -->
        <div v-if="deviceChangeNotification" class="notification success">
            {{ deviceChangeNotification }}
        </div>
        <div v-if="errorNotification" class="notification error">
            {{ errorNotification }}
        </div>
        
        <div class="container">
            <h1>{{ $t('app.title') }}</h1>
            
            <div :class="['status', midiConnected ? 'connected' : 'disconnected']">
                {{ midiConnected ? $t('connection.status.connected', { inputs: midiInputs.length, outputs: midiOutputs.length }) : $t('connection.status.disconnected') }}
            </div>
            
            <div v-if="midiConnected && (inputDeviceNames.length > 0 || outputDeviceNames.length > 0)" style="margin: 10px 0; font-size: 12px;">
                <strong>{{ $t('connection.deviceList.title') }}</strong>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 5px;">
                    <div>
                        <div style="font-weight: bold; color: #4CAF50; margin-bottom: 3px;">{{ $t('connection.deviceList.input.title', { count: inputDeviceNames.length }) }}</div>
                        <div v-for="name in inputDeviceNames" :key="'input-' + name" style="margin: 1px 0; padding-left: 10px; font-size: 11px;">
                            {{ name }}
                        </div>
                        <div v-if="inputDeviceNames.length === 0" style="color: #666; font-style: italic; padding-left: 10px; font-size: 11px;">
                            {{ $t('connection.deviceList.input.none') }}
                        </div>
                    </div>
                    <div>
                        <div style="font-weight: bold; color: #2196F3; margin-bottom: 3px;">{{ $t('connection.deviceList.output.title', { count: outputDeviceNames.length }) }}</div>
                        <div v-for="name in outputDeviceNames" :key="'output-' + name" style="margin: 1px 0; padding-left: 10px; font-size: 11px;">
                            {{ name }}
                        </div>
                        <div v-if="outputDeviceNames.length === 0" style="color: #666; font-style: italic; padding-left: 10px; font-size: 11px;">
                            {{ $t('connection.deviceList.output.none') }}
                        </div>
                    </div>
                </div>
            </div>
            
            <button @click="connectMIDI" :disabled="midiConnected">
                {{ $t('connection.button') }}
            </button>
            
            <button 
                class="tap-area" 
                :class="{ active: isEffectOn }"
                @click="toggleEffect"
                :aria-pressed="isEffectOn"
                :aria-label="isEffectOn ? $t('controls.toggle.ariaLabel.turnOff') : $t('controls.toggle.ariaLabel.turnOn')"
                type="button"
            >
                {{ isEffectOn ? $t('controls.toggle.on') : $t('controls.toggle.off') }}
            </button>
            
            <div>
                <label>{{ $t('controls.settings.channel') }}
                    <select v-model="settings.channel">
                        <option v-for="n in 16" :key="n" :value="n-1">{{ n }}</option>
                    </select>
                </label>
            </div>
            
            <div>
                <label>{{ $t('controls.settings.controller') }}
                    <input type="number" v-model="settings.controller" min="0" max="127">
                </label>
            </div>
            
            <button 
                @click="requestWakeLock" 
                :style="{ 
                    backgroundColor: wakeLockActive ? '#4CAF50' : '#666',
                    color: 'white',
                    border: 'none',
                    padding: '10px 15px',
                    borderRadius: '5px',
                    cursor: 'pointer'
                }"
            >
                {{ wakeLockActive ? $t('controls.wakeLock.on') : $t('controls.wakeLock.off') }}
            </button>
            
            <div v-if="midiConnected" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>{{ $t('log.title') }}</h3>
                    <button @click="clearLogs" style="padding: 5px 10px; font-size: 12px;">{{ $t('log.clearButton') }}</button>
                </div>
                <div id="midi-logs" style="background: #222; border: 1px solid #444; border-radius: 5px; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                    <div v-if="midiLogs.length === 0" style="color: #666;">
                        {{ $t('log.waitingMessage') }}
                    </div>
                    <div v-for="log in midiLogs" :key="log.id" class="log-entry" style="margin: 2px 0; white-space: nowrap;">
                        <span class="log-timestamp">[{{ log.timestamp }}]</span>
                        <span class="log-message"> {{ log.message }}</span>
                        <span class="log-source">{{ log.source }}</span>
                        <span class="log-arrow"> → </span>
                        <span class="log-destinations">{{ log.destinations.join(', ') }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
